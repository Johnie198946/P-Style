# ğŸ“˜ åç«¯å¼€å‘æŒ‡å— - ç…§ç‰‡é£æ ¼å…‹éš† Web åº”ç”¨

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªç…§ç‰‡é£æ ¼å…‹éš†çš„ Web åº”ç”¨ï¼Œç”¨æˆ·ä¸Šä¼ ä¸¤å¼ ç…§ç‰‡ï¼ˆæºç…§ç‰‡å’Œç›®æ ‡ç…§ç‰‡ï¼‰ï¼Œé€šè¿‡ AI åˆ†æåç»™å‡ºè¯¦ç»†çš„ Photoshop å’Œ Adobe Camera Raw (Lightroom) è°ƒæ•´æ–¹æ¡ˆã€‚

### æ ¸å¿ƒåŠŸèƒ½
1. **ç…§ç‰‡ä¸Šä¼ ä¸ç®¡ç†**
2. **AI åˆ†ææœåŠ¡**ï¼ˆä¸¤é˜¶æ®µåˆ†æï¼‰
3. **ç”¨æˆ·å¤´åƒç®¡ç†**
4. **åˆ†æç»“æœå­˜å‚¨ä¸æ£€ç´¢**
5. **é£æ ¼æ¨¡æ‹Ÿ**

---

## ğŸ“Š å‰ç«¯è®¾è®¡æ€»ç»“

### æŠ€æœ¯æ ˆ
- **æ¡†æ¶**: React + TypeScript
- **UI åº“**: Tailwind CSS + Shadcn/ui
- **åŠ¨ç”»**: Motion (Framer Motion)
- **å›¾æ ‡**: Lucide React
- **çŠ¶æ€ç®¡ç†**: React Hooks (useState, useEffect)
- **æœ¬åœ°å­˜å‚¨**: LocalStorage (ç”¨æˆ·å¤´åƒ)

### é¡µé¢æµç¨‹

```
ç”¨æˆ·è¿›å…¥åº”ç”¨
    â†“
[ä¸»é¡µ - ä¸Šä¼ ç…§ç‰‡]
  â€¢ å·¦ä¾§: æºç…§ç‰‡ (å‚è€ƒé£æ ¼)
  â€¢ å³ä¾§: ç›®æ ‡ç…§ç‰‡ (éœ€è¦è°ƒæ•´)
  â€¢ ç›¸ä¼¼åº¦æ£€æµ‹
    â†“
ç‚¹å‡»"å¼€å§‹åˆ†æ"
    â†“
[Loading åŠ¨ç”»]
  â€¢ å…¨å±æ¨¡æ€æ¡†
  â€¢ èƒŒæ™¯è™šåŒ–
  â€¢ åŠ¨ç”»æ•ˆæœ
    â†“
[ç»“æœé¡µ - ç¬¬ä¸€é˜¶æ®µ]
  â€¢ ç…§ç‰‡ç‚¹è¯„
  â€¢ æ„å›¾åˆ†æ (7ç»´åº¦)
  â€¢ å…‰å½±å‚æ•°
  â€¢ è‰²å½©æ–¹æ¡ˆ
  â€¢ [è·å–å®Œæ•´æ–¹æ¡ˆ] æŒ‰é’®
    â†“
ç‚¹å‡»"è·å–å®Œæ•´æ–¹æ¡ˆ"
    â†“
[Loading åŠ¨ç”»]
    â†“
[ç»“æœé¡µ - ç¬¬äºŒé˜¶æ®µ]
  â€¢ ç…§ç‰‡ç‚¹è¯„
  â€¢ æ„å›¾åˆ†æ
  â€¢ å…‰å½±å‚æ•°
  â€¢ è‰²å½©æ–¹æ¡ˆ
  â€¢ Lightroom è°ƒæ•´æ–¹æ¡ˆ â­ æ–°å¢
  â€¢ Photoshop åæœŸæ–¹æ¡ˆ â­ æ–°å¢
  â€¢ [é£æ ¼æ¨¡æ‹Ÿ] æŒ‰é’®
```

### UI/UX ç‰¹ç‚¹

#### 1. ç£æ€§æ‹–æ‹½ä¸Šä¼ 
- é¼ æ ‡æ‹–æ‹½æ–‡ä»¶æ—¶ï¼Œä¸Šä¼ åŒºåŸŸä¼š"å¸å¼•"æ–‡ä»¶
- ç£æ€§æ•ˆæœå‚è€ƒï¼šhttps://www.designspells.com/spells/magnetic-drop-targets

#### 2. ä¸¤é˜¶æ®µåˆ†ææµç¨‹
- **ç¬¬ä¸€é˜¶æ®µ**ï¼šåŸºç¡€åˆ†æï¼ˆå¿«é€Ÿè¿”å›ï¼‰
  - ç…§ç‰‡ç‚¹è¯„
  - æ„å›¾åˆ†æï¼ˆ7ç»´åº¦ä¸“ä¸šåˆ†æï¼‰
  - å…‰å½±å‚æ•°
  - è‰²å½©æ–¹æ¡ˆ
  
- **ç¬¬äºŒé˜¶æ®µ**ï¼šå®Œæ•´æ–¹æ¡ˆï¼ˆæ·±åº¦åˆ†æï¼‰
  - ç¬¬ä¸€é˜¶æ®µçš„æ‰€æœ‰å†…å®¹
  - Lightroom å®Œæ•´å‚æ•°
  - Photoshop è¯¦ç»†æ­¥éª¤

#### 3. æ„å›¾åˆ†æ - 7ç»´åº¦ä¸“ä¸šåˆ†æ
æ ¹æ®ä¸“ä¸šæ‘„å½±å¸ˆçš„æ ‡å‡†ï¼Œæä¾›ä»¥ä¸‹7ä¸ªç»´åº¦çš„åˆ†æï¼š
1. **ç”»é¢ä¸»ç»“æ„åˆ†æ**
2. **ä¸»ä½“ä½ç½®ä¸è§†è§‰æƒé‡**
3. **çº¿æ¡ä¸æ–¹å‘å¼•å¯¼**
4. **ç©ºé—´å±‚æ¬¡ä¸åˆ†åŒº**
5. **æ¯”ä¾‹ä¸ç•™ç™½**
6. **è§†è§‰å¹³è¡¡ä¸åŠ¨åŠ¿**
7. **æ„å›¾é£æ ¼å½’ç±»ä¸æ”¹è¿›å»ºè®®**

#### 4. è¯¦ç»†çš„è°ƒæ•´æ–¹æ¡ˆ
æ¯ä¸ªæ–¹æ¡ˆå¿…é¡»åŒ…å«ï¼š
- **é‡åŒ–æ•°æ®**ï¼ˆå…·ä½“çš„æ•°å€¼èŒƒå›´ï¼‰
- **å‚æ•°è¯´æ˜**ï¼ˆæ¯ä¸ªå‚æ•°çš„ä½œç”¨ï¼‰
- **è°ƒæ•´æ­¥éª¤**ï¼ˆæ“ä½œé¡ºåºï¼‰
- **ä¸“ä¸šå»ºè®®**ï¼ˆæ³¨æ„äº‹é¡¹ï¼‰

#### 5. è®¾è®¡é£æ ¼
å®Œå…¨æ¨¡ä»¿ [DesignSpells.com](https://www.designspells.com) çš„é£æ ¼ï¼š
- ç°ä»£ç®€çº¦
- æ¸å˜è‰² + æ¯›ç»ç’ƒæ•ˆæœ
- æµç•…çš„åŠ¨ç”»
- å¡ç‰‡å¼è®¾è®¡

---

## ğŸ”Œ API æ¥å£è®¾è®¡

### 1. ç…§ç‰‡ä¸Šä¼ æ¥å£

#### ç«¯ç‚¹
```
POST /api/photos/upload
```

#### è¯·æ±‚æ ¼å¼
```typescript
Content-Type: multipart/form-data

{
  sourcePhoto: File,      // æºç…§ç‰‡ï¼ˆå‚è€ƒé£æ ¼ï¼‰
  targetPhoto: File,      // ç›®æ ‡ç…§ç‰‡ï¼ˆéœ€è¦è°ƒæ•´ï¼‰
  userId?: string         // ç”¨æˆ·IDï¼ˆå¯é€‰ï¼‰
}
```

#### å“åº”æ ¼å¼
```typescript
{
  success: boolean,
  data: {
    uploadId: string,           // ä¸Šä¼ ä»»åŠ¡ID
    sourcePhotoUrl: string,     // æºç…§ç‰‡URL
    targetPhotoUrl: string,     // ç›®æ ‡ç…§ç‰‡URL
    similarity: number,         // ç›¸ä¼¼åº¦ (0-100)
    uploadTime: string          // ä¸Šä¼ æ—¶é—´
  },
  message?: string
}
```

#### ä¸šåŠ¡é€»è¾‘
1. **æ¥æ”¶æ–‡ä»¶**
   - éªŒè¯æ–‡ä»¶æ ¼å¼ï¼ˆJPEG, PNG, WEBPï¼‰
   - éªŒè¯æ–‡ä»¶å¤§å°ï¼ˆå»ºè®®é™åˆ¶ 10MBï¼‰
   - ç”Ÿæˆå”¯ä¸€çš„æ–‡ä»¶å

2. **å­˜å‚¨æ–‡ä»¶**
   - å­˜å‚¨åˆ°å¯¹è±¡å­˜å‚¨æœåŠ¡ï¼ˆå¦‚ AWS S3, é˜¿é‡Œäº‘ OSSï¼‰
   - ç”Ÿæˆå¯è®¿é—®çš„ URL
   - å¯é€‰ï¼šç”Ÿæˆç¼©ç•¥å›¾

3. **è®¡ç®—ç›¸ä¼¼åº¦**
   - ä½¿ç”¨å›¾åƒå“ˆå¸Œç®—æ³•ï¼ˆpHash, dHashï¼‰
   - æˆ–ä½¿ç”¨æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼ˆå¦‚ Inception, ResNetï¼‰
   - è¿”å›ç›¸ä¼¼åº¦åˆ†æ•° (0-100)

4. **è®°å½•ä¸Šä¼ ä¿¡æ¯**
   - ä¿å­˜åˆ°æ•°æ®åº“
   - å…³è”ç”¨æˆ·ID
   - è®°å½•ä¸Šä¼ æ—¶é—´

---

### 2. ç¬¬ä¸€é˜¶æ®µåˆ†ææ¥å£

#### ç«¯ç‚¹
```
POST /api/analysis/stage1
```

#### è¯·æ±‚æ ¼å¼
```typescript
{
  uploadId: string,           // ä¸Šä¼ ä»»åŠ¡ID
  sourcePhotoUrl: string,     // æºç…§ç‰‡URL
  targetPhotoUrl: string      // ç›®æ ‡ç…§ç‰‡URL
}
```

#### å“åº”æ ¼å¼
```typescript
{
  success: boolean,
  data: {
    analysisId: string,       // åˆ†æä»»åŠ¡ID
    review: ReviewData,       // ç…§ç‰‡ç‚¹è¯„
    composition: CompositionData,  // æ„å›¾åˆ†æ
    lighting: LightingData,   // å…‰å½±å‚æ•°
    color: ColorData          // è‰²å½©æ–¹æ¡ˆ
  },
  message?: string
}
```

#### æ•°æ®ç»“æ„è¯¦ç»†è¯´æ˜

##### ReviewDataï¼ˆç…§ç‰‡ç‚¹è¯„ï¼‰
```typescript
interface ReviewData {
  overall: string;            // æ•´ä½“è¯„ä»·
  strengths: string[];        // ä¼˜ç‚¹åˆ—è¡¨
  weaknesses: string[];       // ä¸è¶³åˆ—è¡¨
  suggestions: string[];      // æ”¹è¿›å»ºè®®
  technicalScore: number;     // æŠ€æœ¯è¯„åˆ† (0-100)
  artisticScore: number;      // è‰ºæœ¯è¯„åˆ† (0-100)
  emotion: string;            // æƒ…æ„ŸåŸºè°ƒ
}
```

##### CompositionDataï¼ˆæ„å›¾åˆ†æ - 7ç»´åº¦ï¼‰
```typescript
interface CompositionData {
  // 1. ç”»é¢ä¸»ç»“æ„åˆ†æ
  mainStructure: {
    type: string;             // æ„å›¾ç±»å‹ï¼ˆå¦‚ï¼šä¸‰åˆ†æ³•ã€é»„é‡‘åˆ†å‰²ã€å¯¹ç§°ï¼‰
    description: string;      // è¯¦ç»†æè¿°
    effectiveness: number;    // æœ‰æ•ˆæ€§è¯„åˆ† (0-100)
  };
  
  // 2. ä¸»ä½“ä½ç½®ä¸è§†è§‰æƒé‡
  subjectPlacement: {
    position: string;         // ä¸»ä½“ä½ç½®
    visualWeight: number;     // è§†è§‰æƒé‡ (0-100)
    focusPoint: {
      x: number;              // ç„¦ç‚¹Xåæ ‡ (0-1)
      y: number;              // ç„¦ç‚¹Yåæ ‡ (0-1)
    };
    analysis: string;         // åˆ†æè¯´æ˜
  };
  
  // 3. çº¿æ¡ä¸æ–¹å‘å¼•å¯¼
  linesAndDirection: {
    leadingLines: string[];   // å¼•å¯¼çº¿ç±»å‹
    direction: string;        // ä¸»è¦æ–¹å‘
    effectiveness: number;    // å¼•å¯¼æ•ˆæœ (0-100)
    suggestions: string[];    // ä¼˜åŒ–å»ºè®®
  };
  
  // 4. ç©ºé—´å±‚æ¬¡ä¸åˆ†åŒº
  spatialLayers: {
    foreground: string;       // å‰æ™¯æè¿°
    middleground: string;     // ä¸­æ™¯æè¿°
    background: string;       // èƒŒæ™¯æè¿°
    depthScore: number;       // æ·±åº¦æ„Ÿè¯„åˆ† (0-100)
    layerBalance: number;     // å±‚æ¬¡å¹³è¡¡ (0-100)
  };
  
  // 5. æ¯”ä¾‹ä¸ç•™ç™½
  proportionAndSpace: {
    subjectRatio: number;     // ä¸»ä½“å æ¯” (0-100)
    negativeSpace: number;    // ç•™ç™½å æ¯” (0-100)
    balance: string;          // å¹³è¡¡è¯„ä»·
    recommendations: string[]; // å»ºè®®
  };
  
  // 6. è§†è§‰å¹³è¡¡ä¸åŠ¨åŠ¿
  balanceAndDynamics: {
    balanceType: string;      // å¹³è¡¡ç±»å‹ï¼ˆå¯¹ç§°/ä¸å¯¹ç§°ï¼‰
    balanceScore: number;     // å¹³è¡¡è¯„åˆ† (0-100)
    dynamicElements: string[]; // åŠ¨æ€å…ƒç´ 
    tension: number;          // å¼ åŠ›å€¼ (0-100)
  };
  
  // 7. æ„å›¾é£æ ¼å½’ç±»ä¸æ”¹è¿›å»ºè®®
  styleAndImprovements: {
    style: string;            // æ„å›¾é£æ ¼ï¼ˆå¦‚ï¼šæç®€ä¸»ä¹‰ã€å¤å…¸ï¼‰
    strengths: string[];      // ä¼˜åŠ¿
    improvements: string[];   // æ”¹è¿›å»ºè®®
    alternativeStyles: string[]; // å¯é€‰é£æ ¼
  };
}
```

##### LightingDataï¼ˆå…‰å½±å‚æ•°ï¼‰
```typescript
interface LightingData {
  // å…‰æºåˆ†æ
  lightSource: {
    type: string;             // å…‰æºç±»å‹ï¼ˆè‡ªç„¶å…‰/äººé€ å…‰ï¼‰
    direction: string;        // å…‰çº¿æ–¹å‘
    quality: string;          // å…‰çº¿è´¨é‡ï¼ˆç¡¬å…‰/è½¯å…‰ï¼‰
    colorTemperature: number; // è‰²æ¸© (K)
  };
  
  // æ›å…‰å‚æ•°
  exposure: {
    overall: string;          // æ•´ä½“æ›å…‰è¯„ä»·
    highlights: number;       // é«˜å…‰ (-100 to 100)
    shadows: number;          // é˜´å½± (-100 to 100)
    contrast: number;         // å¯¹æ¯”åº¦ (-100 to 100)
    histogram: {
      shadows: number;        // é˜´å½±åˆ†å¸ƒ (0-100)
      midtones: number;       // ä¸­é—´è°ƒåˆ†å¸ƒ (0-100)
      highlights: number;     // é«˜å…‰åˆ†å¸ƒ (0-100)
    };
  };
  
  // æ˜æš—å±‚æ¬¡
  tonalRange: {
    dynamicRange: number;     // åŠ¨æ€èŒƒå›´ (EV)
    blackPoint: number;       // é»‘ç‚¹ (0-255)
    whitePoint: number;       // ç™½ç‚¹ (0-255)
    midtoneValue: number;     // ä¸­é—´è°ƒå€¼ (0-255)
  };
  
  // è°ƒæ•´å»ºè®®
  adjustments: {
    exposure: number;         // æ›å…‰è¡¥å¿ (-2 to +2 EV)
    highlights: number;       // é«˜å…‰è°ƒæ•´ (-100 to 100)
    shadows: number;          // é˜´å½±è°ƒæ•´ (-100 to 100)
    whites: number;           // ç™½è‰²è‰²é˜¶ (-100 to 100)
    blacks: number;           // é»‘è‰²è‰²é˜¶ (-100 to 100)
    contrast: number;         // å¯¹æ¯”åº¦ (-100 to 100)
  };
}
```

##### ColorDataï¼ˆè‰²å½©æ–¹æ¡ˆï¼‰
```typescript
interface ColorData {
  // ä¸»è‰²è°ƒåˆ†æ
  dominantColors: Array<{
    hex: string;              // åå…­è¿›åˆ¶é¢œè‰²
    rgb: { r: number; g: number; b: number };
    hsl: { h: number; s: number; l: number };
    percentage: number;       // å æ¯” (0-100)
    name: string;             // é¢œè‰²åç§°
  }>;
  
  // è‰²å½©å’Œè°åº¦
  colorHarmony: {
    scheme: string;           // é…è‰²æ–¹æ¡ˆï¼ˆäº’è¡¥/ç±»ä¼¼/ä¸‰è§’ï¼‰
    harmony: number;          // å’Œè°åº¦ (0-100)
    temperature: string;      // è‰²æ¸©å€¾å‘ï¼ˆå†·/æš–/ä¸­æ€§ï¼‰
  };
  
  // HSL è°ƒæ•´
  hslAdjustments: {
    red: { hue: number; saturation: number; luminance: number };
    orange: { hue: number; saturation: number; luminance: number };
    yellow: { hue: number; saturation: number; luminance: number };
    green: { hue: number; saturation: number; luminance: number };
    aqua: { hue: number; saturation: number; luminance: number };
    blue: { hue: number; saturation: number; luminance: number };
    purple: { hue: number; saturation: number; luminance: number };
    magenta: { hue: number; saturation: number; luminance: number };
  };
  
  // æ•´ä½“è‰²å½©è°ƒæ•´
  globalAdjustments: {
    temperature: number;      // è‰²æ¸© (-100 to 100)
    tint: number;             // è‰²è°ƒ (-100 to 100)
    vibrance: number;         // è‡ªç„¶é¥±å’Œåº¦ (-100 to 100)
    saturation: number;       // é¥±å’Œåº¦ (-100 to 100)
  };
}
```

#### ä¸šåŠ¡é€»è¾‘

1. **è·å–ç…§ç‰‡**
   - ä»å¯¹è±¡å­˜å‚¨ä¸‹è½½ç…§ç‰‡
   - æˆ–ç›´æ¥ä½¿ç”¨URLè®¿é—®

2. **è°ƒç”¨ AI åˆ†ææœåŠ¡**
   - ä½¿ç”¨ GPT-4 Vision æˆ–å…¶ä»–å¤šæ¨¡æ€å¤§æ¨¡å‹
   - æä¾›è¯¦ç»†çš„ Promptï¼ˆè§ä¸‹æ–¹ Prompt æŒ‡å—ï¼‰

3. **è§£æ AI å“åº”**
   - æå–ç»“æ„åŒ–æ•°æ®
   - éªŒè¯æ•°æ®å®Œæ•´æ€§
   - æ ¼å¼åŒ–ä¸ºæ ‡å‡†æ ¼å¼

4. **å­˜å‚¨åˆ†æç»“æœ**
   - ä¿å­˜åˆ°æ•°æ®åº“
   - å…³è” uploadId
   - è®°å½•åˆ†ææ—¶é—´

---

### 3. ç¬¬äºŒé˜¶æ®µåˆ†ææ¥å£

#### ç«¯ç‚¹
```
POST /api/analysis/stage2
```

#### è¯·æ±‚æ ¼å¼
```typescript
{
  analysisId: string,         // ç¬¬ä¸€é˜¶æ®µçš„åˆ†æID
  uploadId: string,           // ä¸Šä¼ ä»»åŠ¡ID
  sourcePhotoUrl: string,     // æºç…§ç‰‡URL
  targetPhotoUrl: string      // ç›®æ ‡ç…§ç‰‡URL
}
```

#### å“åº”æ ¼å¼
```typescript
{
  success: boolean,
  data: {
    // åŒ…å«ç¬¬ä¸€é˜¶æ®µçš„æ‰€æœ‰æ•°æ®
    review: ReviewData,
    composition: CompositionData,
    lighting: LightingData,
    color: ColorData,
    
    // æ–°å¢çš„ç¬¬äºŒé˜¶æ®µæ•°æ®
    lightroom: LightroomData,     // Lightroom è°ƒæ•´æ–¹æ¡ˆ
    photoshop: PhotoshopData,     // Photoshop åæœŸæ–¹æ¡ˆ
    lightroom_extra?: any         // Lightroom é¢å¤–æ•°æ®ï¼ˆæ›²çº¿ç­‰ï¼‰
  },
  message?: string
}
```

#### æ•°æ®ç»“æ„è¯¦ç»†è¯´æ˜

##### LightroomDataï¼ˆLightroom è°ƒæ•´æ–¹æ¡ˆï¼‰
```typescript
interface LightroomData {
  // åŸºæœ¬è°ƒæ•´ (Basic Panel)
  basic: {
    treatment: string;          // å¤„ç†æ–¹å¼ (Color/Black & White)
    temperature: number;        // è‰²æ¸© (-100 to 100)
    tint: number;               // è‰²è°ƒ (-100 to 100)
    exposure: number;           // æ›å…‰ (-5 to +5)
    contrast: number;           // å¯¹æ¯”åº¦ (-100 to 100)
    highlights: number;         // é«˜å…‰ (-100 to 100)
    shadows: number;            // é˜´å½± (-100 to 100)
    whites: number;             // ç™½è‰²è‰²é˜¶ (-100 to 100)
    blacks: number;             // é»‘è‰²è‰²é˜¶ (-100 to 100)
    texture: number;            // çº¹ç† (-100 to 100)
    clarity: number;            // æ¸…æ™°åº¦ (-100 to 100)
    dehaze: number;             // å»æœ¦èƒ§ (-100 to 100)
    vibrance: number;           // è‡ªç„¶é¥±å’Œåº¦ (-100 to 100)
    saturation: number;         // é¥±å’Œåº¦ (-100 to 100)
  };
  
  // è‰²è°ƒæ›²çº¿ (Tone Curve)
  toneCurve: {
    parametric: {
      highlights: number;       // é«˜å…‰ (-100 to 100)
      lights: number;           // äº®éƒ¨ (-100 to 100)
      darks: number;            // æš—éƒ¨ (-100 to 100)
      shadows: number;          // é˜´å½± (-100 to 100)
    };
    pointCurve?: {
      red: Array<{ x: number; y: number }>;
      green: Array<{ x: number; y: number }>;
      blue: Array<{ x: number; y: number }>;
      rgb: Array<{ x: number; y: number }>;
    };
  };
  
  // HSL/é¢œè‰² (HSL/Color Panel)
  hsl: {
    hue: {
      red: number;              // -100 to 100
      orange: number;
      yellow: number;
      green: number;
      aqua: number;
      blue: number;
      purple: number;
      magenta: number;
    };
    saturation: {
      red: number;
      orange: number;
      yellow: number;
      green: number;
      aqua: number;
      blue: number;
      purple: number;
      magenta: number;
    };
    luminance: {
      red: number;
      orange: number;
      yellow: number;
      green: number;
      aqua: number;
      blue: number;
      purple: number;
      magenta: number;
    };
  };
  
  // åˆ†ç¦»è‰²è°ƒ (Split Toning)
  splitToning: {
    highlights: {
      hue: number;              // 0-360
      saturation: number;       // 0-100
    };
    shadows: {
      hue: number;
      saturation: number;
    };
    balance: number;            // -100 to 100
  };
  
  // ç»†èŠ‚ (Detail Panel)
  detail: {
    sharpening: {
      amount: number;           // 0-150
      radius: number;           // 0.5-3.0
      detail: number;           // 0-100
      masking: number;          // 0-100
    };
    noiseReduction: {
      luminance: number;        // 0-100
      luminanceDetail: number;  // 0-100
      luminanceContrast: number; // 0-100
      color: number;            // 0-100
      colorDetail: number;      // 0-100
      colorSmoothness: number;  // 0-100
    };
  };
  
  // é•œå¤´æ ¡æ­£ (Lens Corrections)
  lensCorrections: {
    enableProfileCorrections: boolean;
    removeChromati AbAgency: boolean;
    distortion: number;         // -100 to 100
    vignetting: number;         // -100 to 100
  };
  
  // æ•ˆæœ (Effects)
  effects: {
    vignette: {
      amount: number;           // -100 to 100
      midpoint: number;         // 0-100
      roundness: number;        // -100 to 100
      feather: number;          // 0-100
    };
    grain: {
      amount: number;           // 0-100
      size: number;             // 0-100
      roughness: number;        // 0-100
    };
  };
  
  // æ ¡å‡† (Calibration)
  calibration: {
    shadows: {
      tint: number;             // -100 to 100
    };
    red: {
      hue: number;
      saturation: number;
    };
    green: {
      hue: number;
      saturation: number;
    };
    blue: {
      hue: number;
      saturation: number;
    };
  };
  
  // è°ƒæ•´æ­¥éª¤è¯´æ˜
  steps: Array<{
    order: number;              // æ­¥éª¤é¡ºåº
    panel: string;              // é¢æ¿åç§°
    description: string;        // æ“ä½œè¯´æ˜
    parameters: { [key: string]: number }; // å‚æ•°è®¾ç½®
    note?: string;              // æ³¨æ„äº‹é¡¹
  }>;
  
  // é¢„è®¾å»ºè®®
  presetSuggestions?: {
    style: string;              // é£æ ¼åç§°
    description: string;        // é£æ ¼æè¿°
    suitableFor: string[];      // é€‚ç”¨åœºæ™¯
  };
}
```

##### PhotoshopDataï¼ˆPhotoshop åæœŸæ–¹æ¡ˆï¼‰
```typescript
interface PhotoshopData {
  // å›¾å±‚ç»“æ„
  layers: Array<{
    id: string;
    name: string;               // å›¾å±‚åç§°
    type: string;               // å›¾å±‚ç±»å‹ (adjustment/normal/smart object)
    blendMode: string;          // æ··åˆæ¨¡å¼
    opacity: number;            // ä¸é€æ˜åº¦ (0-100)
    order: number;              // å›¾å±‚é¡ºåº
    description: string;        // å›¾å±‚è¯´æ˜
  }>;
  
  // è°ƒæ•´å›¾å±‚è¯¦ç»†å‚æ•°
  adjustmentLayers: Array<{
    id: string;
    layerId: string;            // å…³è”çš„å›¾å±‚ID
    type: string;               // è°ƒæ•´ç±»å‹
    parameters: any;            // å‚æ•°ï¼ˆæ ¹æ®ç±»å‹ä¸åŒï¼‰
    mask?: MaskData;            // è’™ç‰ˆæ•°æ®
    blendIf?: BlendIfData;      // æ··åˆæ¡ä»¶
  }>;
  
  // æ›²çº¿è°ƒæ•´
  curves: Array<{
    layerId: string;
    channel: string;            // RGB/Red/Green/Blue
    points: Array<{
      input: number;            // è¾“å…¥å€¼ (0-255)
      output: number;           // è¾“å‡ºå€¼ (0-255)
    }>;
    description: string;
  }>;
  
  // è‰²å½©å¹³è¡¡
  colorBalance: Array<{
    layerId: string;
    shadows: {
      cyan_red: number;         // -100 to 100
      magenta_green: number;
      yellow_blue: number;
    };
    midtones: {
      cyan_red: number;
      magenta_green: number;
      yellow_blue: number;
    };
    highlights: {
      cyan_red: number;
      magenta_green: number;
      yellow_blue: number;
    };
    preserveLuminosity: boolean;
  }>;
  
  // è‰²ç›¸/é¥±å’Œåº¦
  hueSaturation: Array<{
    layerId: string;
    master: {
      hue: number;              // -180 to 180
      saturation: number;       // -100 to 100
      lightness: number;        // -100 to 100
    };
    reds?: { hue: number; saturation: number; lightness: number };
    yellows?: { hue: number; saturation: number; lightness: number };
    greens?: { hue: number; saturation: number; lightness: number };
    cyans?: { hue: number; saturation: number; lightness: number };
    blues?: { hue: number; saturation: number; lightness: number };
    magentas?: { hue: number; saturation: number; lightness: number };
    colorize?: boolean;
  }>;
  
  // Camera Raw æ»¤é•œ
  cameraRaw?: {
    // ä¸ Lightroom å‚æ•°ç±»ä¼¼
    basic: any;
    detail: any;
    // ... å…¶ä»–å‚æ•°
  };
  
  // æ»¤é•œ
  filters: Array<{
    name: string;               // æ»¤é•œåç§°
    category: string;           // æ»¤é•œç±»åˆ«
    parameters: { [key: string]: any };
    applyTo: string;            // åº”ç”¨åˆ°å“ªä¸ªå›¾å±‚
    order: number;              // åº”ç”¨é¡ºåº
  }>;
  
  // è’™ç‰ˆæ–¹æ¡ˆ
  masks: Array<{
    id: string;
    layerId: string;
    type: string;               // layer/vector/clipping
    feather: number;            // ç¾½åŒ– (px)
    density: number;            // å¯†åº¦ (0-100)
    description: string;        // è’™ç‰ˆè¯´æ˜
    technique?: string;         // åˆ›å»ºæŠ€å·§
  }>;
  
  // è¯¦ç»†æ­¥éª¤
  steps: Array<{
    order: number;
    category: string;           // æ­¥éª¤ç±»åˆ«
    title: string;              // æ­¥éª¤æ ‡é¢˜
    description: string;        // è¯¦ç»†è¯´æ˜
    tools: string[];            // ä½¿ç”¨çš„å·¥å…·
    parameters?: any;           // å‚æ•°è®¾ç½®
    tips?: string[];            // æŠ€å·§æç¤º
    screenshots?: string[];     // æˆªå›¾è¯´æ˜ï¼ˆå¯é€‰ï¼‰
  }>;
  
  // å¿«æ·é”®æç¤º
  shortcuts?: Array<{
    action: string;
    windows: string;
    mac: string;
  }>;
  
  // æ³¨æ„äº‹é¡¹
  notes: string[];
  
  // æ¨èæ’ä»¶
  recommendedPlugins?: Array<{
    name: string;
    purpose: string;
    link?: string;
  }>;
}

// è’™ç‰ˆæ•°æ®
interface MaskData {
  type: string;                 // pixel/vector
  feather: number;
  density: number;
  invert: boolean;
}

// æ··åˆæ¡ä»¶
interface BlendIfData {
  channel: string;              // Gray/Red/Green/Blue
  thisLayer: { min: number; max: number };
  underlyingLayer: { min: number; max: number };
}
```

#### ä¸šåŠ¡é€»è¾‘

1. **è·å–ç¬¬ä¸€é˜¶æ®µç»“æœ**
   - ä»æ•°æ®åº“è¯»å–
   - éªŒè¯æ•°æ®å®Œæ•´æ€§

2. **è°ƒç”¨ AI æ·±åº¦åˆ†æ**
   - ä½¿ç”¨æ›´è¯¦ç»†çš„ Prompt
   - è¦æ±‚ç”Ÿæˆå®Œæ•´çš„ LR/PS å‚æ•°
   - ç­‰å¾…æ—¶é—´å¯èƒ½è¾ƒé•¿ï¼ˆ30-60ç§’ï¼‰

3. **è§£æå¹¶éªŒè¯å“åº”**
   - éªŒè¯æ‰€æœ‰å‚æ•°åœ¨åˆç†èŒƒå›´å†…
   - ç¡®ä¿æ­¥éª¤çš„å®Œæ•´æ€§å’Œå¯æ“ä½œæ€§

4. **å­˜å‚¨å®Œæ•´ç»“æœ**
   - æ›´æ–°æ•°æ®åº“è®°å½•
   - æ ‡è®°ä¸ºå®Œæ•´åˆ†æ
   - è®°å½•å®Œæˆæ—¶é—´

---

### 4. ç”¨æˆ·å¤´åƒæ¥å£

#### 4.1 ä¸Šä¼ å¤´åƒ
```
POST /api/user/avatar/upload
```

**è¯·æ±‚æ ¼å¼**:
```typescript
Content-Type: multipart/form-data

{
  avatar: File,               // å¤´åƒæ–‡ä»¶
  userId: string              // ç”¨æˆ·ID
}
```

**å“åº”æ ¼å¼**:
```typescript
{
  success: boolean,
  data: {
    avatarUrl: string,        // å¤´åƒURL
    thumbnailUrl?: string     // ç¼©ç•¥å›¾URLï¼ˆå¯é€‰ï¼‰
  },
  message?: string
}
```

#### 4.2 è·å–å¤´åƒ
```
GET /api/user/avatar/:userId
```

**å“åº”æ ¼å¼**:
```typescript
{
  success: boolean,
  data: {
    avatarUrl: string | null
  }
}
```

#### 4.3 åˆ é™¤å¤´åƒ
```
DELETE /api/user/avatar/:userId
```

**å“åº”æ ¼å¼**:
```typescript
{
  success: boolean,
  message: string
}
```

---

### 5. åˆ†æå†å²æ¥å£

#### 5.1 è·å–ç”¨æˆ·çš„åˆ†æå†å²
```
GET /api/analysis/history/:userId?page=1&limit=10
```

**å“åº”æ ¼å¼**:
```typescript
{
  success: boolean,
  data: {
    total: number,
    page: number,
    limit: number,
    items: Array<{
      analysisId: string,
      uploadId: string,
      sourcePhotoUrl: string,
      targetPhotoUrl: string,
      stage: 'stage1' | 'stage2',
      createdAt: string,
      preview?: {
        dominantColor: string,
        style: string
      }
    }>
  }
}
```

#### 5.2 è·å–å•ä¸ªåˆ†æç»“æœ
```
GET /api/analysis/:analysisId
```

**å“åº”æ ¼å¼**:
```typescript
{
  success: boolean,
  data: {
    analysisId: string,
    uploadId: string,
    sourcePhotoUrl: string,
    targetPhotoUrl: string,
    stage: 'stage1' | 'stage2',
    results: {
      review: ReviewData,
      composition: CompositionData,
      lighting: LightingData,
      color: ColorData,
      lightroom?: LightroomData,
      photoshop?: PhotoshopData
    },
    createdAt: string,
    updatedAt: string
  }
}
```

---

## ğŸ¤– AI Prompt è®¾è®¡æŒ‡å—

### GPT-4 Vision Prompt ç»“æ„

#### ç¬¬ä¸€é˜¶æ®µ Promptï¼ˆåŸºç¡€åˆ†æï¼‰

```
ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„æ‘„å½±å¸ˆå’ŒåæœŸå¤„ç†ä¸“å®¶ã€‚è¯·åˆ†æç”¨æˆ·ä¸Šä¼ çš„ä¸¤å¼ ç…§ç‰‡ï¼š

ã€æºç…§ç‰‡ã€‘: [source_photo_url]
è¿™æ˜¯ç”¨æˆ·å¸Œæœ›æ¨¡ä»¿çš„ç…§ç‰‡é£æ ¼ã€‚

ã€ç›®æ ‡ç…§ç‰‡ã€‘: [target_photo_url]
è¿™æ˜¯ç”¨æˆ·éœ€è¦è°ƒæ•´çš„ç…§ç‰‡ã€‚

è¯·æä¾›ä»¥ä¸‹åˆ†æï¼ˆä»¥JSONæ ¼å¼è¿”å›ï¼‰ï¼š

1. **ç…§ç‰‡ç‚¹è¯„** (review)
   - overall: æ•´ä½“è¯„ä»·ï¼ˆ200-300å­—ï¼‰
   - strengths: ä¼˜ç‚¹åˆ—è¡¨ï¼ˆ3-5ä¸ªï¼‰
   - weaknesses: ä¸è¶³åˆ—è¡¨ï¼ˆ3-5ä¸ªï¼‰
   - suggestions: æ”¹è¿›å»ºè®®ï¼ˆ3-5ä¸ªï¼‰
   - technicalScore: æŠ€æœ¯è¯„åˆ†ï¼ˆ0-100ï¼‰
   - artisticScore: è‰ºæœ¯è¯„åˆ†ï¼ˆ0-100ï¼‰
   - emotion: æƒ…æ„ŸåŸºè°ƒ

2. **æ„å›¾åˆ†æ** (composition) - è¯·æŒ‰ç…§ä»¥ä¸‹7ä¸ªä¸“ä¸šç»´åº¦åˆ†æï¼š
   
   a) ç”»é¢ä¸»ç»“æ„åˆ†æ
      - è¯†åˆ«æ„å›¾ç±»å‹ï¼ˆä¸‰åˆ†æ³•/é»„é‡‘åˆ†å‰²/å¯¹ç§°/æ¡†æ¶/å¼•å¯¼çº¿ç­‰ï¼‰
      - è¯„ä¼°ä¸»ç»“æ„çš„æœ‰æ•ˆæ€§
   
   b) ä¸»ä½“ä½ç½®ä¸è§†è§‰æƒé‡
      - ä¸»ä½“åœ¨ç”»é¢ä¸­çš„ä½ç½®
      - è§†è§‰æƒé‡åˆ†æ
      - ç„¦ç‚¹åæ ‡
   
   c) çº¿æ¡ä¸æ–¹å‘å¼•å¯¼
      - å¼•å¯¼çº¿ç±»å‹
      - è§†è§‰æµåŠ¨æ–¹å‘
      - å¼•å¯¼æ•ˆæœè¯„ä¼°
   
   d) ç©ºé—´å±‚æ¬¡ä¸åˆ†åŒº
      - å‰æ™¯/ä¸­æ™¯/èƒŒæ™¯åˆ†æ
      - æ·±åº¦æ„Ÿè¯„ä¼°
      - å±‚æ¬¡å¹³è¡¡
   
   e) æ¯”ä¾‹ä¸ç•™ç™½
      - ä¸»ä½“å æ¯”
      - è´Ÿç©ºé—´å¤„ç†
      - å¹³è¡¡æ„Ÿ
   
   f) è§†è§‰å¹³è¡¡ä¸åŠ¨åŠ¿
      - å¹³è¡¡ç±»å‹
      - åŠ¨æ€å…ƒç´ 
      - å¼ åŠ›åˆ†æ
   
   g) æ„å›¾é£æ ¼å½’ç±»ä¸æ”¹è¿›å»ºè®®
      - é£æ ¼è¯†åˆ«
      - ä¼˜åŠ¿æ€»ç»“
      - æ”¹è¿›æ–¹å‘
      - å¯é€‰é£æ ¼

3. **å…‰å½±å‚æ•°** (lighting)
   - å…‰æºåˆ†æï¼ˆç±»å‹ã€æ–¹å‘ã€è´¨é‡ã€è‰²æ¸©ï¼‰
   - æ›å…‰å‚æ•°è¯„ä¼°
   - æ˜æš—å±‚æ¬¡åˆ†æ
   - å…·ä½“è°ƒæ•´å»ºè®®ï¼ˆåŒ…å«æ•°å€¼èŒƒå›´ï¼‰

4. **è‰²å½©æ–¹æ¡ˆ** (color)
   - ä¸»è‰²è°ƒæå–ï¼ˆè‡³å°‘5ä¸ªï¼ŒåŒ…å«hexã€rgbã€hslã€å æ¯”ã€åç§°ï¼‰
   - è‰²å½©å’Œè°åº¦åˆ†æ
   - HSLè¯¦ç»†è°ƒæ•´å‚æ•°ï¼ˆ8ä¸ªè‰²ç›¸ï¼šçº¢ã€æ©™ã€é»„ã€ç»¿ã€é’ã€è“ã€ç´«ã€å“ï¼‰
   - æ•´ä½“è‰²å½©è°ƒæ•´å»ºè®®

**é‡è¦è¦æ±‚**ï¼š
1. æ‰€æœ‰æ•°å€¼å¿…é¡»ç²¾ç¡®ï¼ŒåŒ…å«å…·ä½“èŒƒå›´
2. æ„å›¾åˆ†æå¿…é¡»æ¶µç›–å…¨éƒ¨7ä¸ªç»´åº¦
3. æ¯ä¸ªç»´åº¦éƒ½è¦æœ‰é‡åŒ–è¯„åˆ†å’Œè¯¦ç»†è¯´æ˜
4. è¿”å›æ ‡å‡†JSONæ ¼å¼ï¼Œç¡®ä¿å¯ä»¥ç›´æ¥è§£æ
5. æ‰€æœ‰æ–‡æœ¬ä½¿ç”¨ä¸­æ–‡

è¿”å›æ ¼å¼ç¤ºä¾‹ï¼š
{
  "review": { ... },
  "composition": {
    "mainStructure": { ... },
    "subjectPlacement": { ... },
    ...
  },
  "lighting": { ... },
  "color": { ... }
}
```

#### ç¬¬äºŒé˜¶æ®µ Promptï¼ˆæ·±åº¦åˆ†æï¼‰

```
åŸºäºç¬¬ä¸€é˜¶æ®µçš„åˆ†æç»“æœï¼Œç°åœ¨è¯·ç”Ÿæˆè¯¦ç»†çš„Lightroomå’ŒPhotoshopè°ƒæ•´æ–¹æ¡ˆã€‚

ã€æºç…§ç‰‡ã€‘: [source_photo_url]
ã€ç›®æ ‡ç…§ç‰‡ã€‘: [target_photo_url]
ã€ç¬¬ä¸€é˜¶æ®µåˆ†æã€‘: [stage1_results]

è¯·æä¾›ä»¥ä¸‹å†…å®¹ï¼ˆJSONæ ¼å¼ï¼‰ï¼š

1. **Lightroom è°ƒæ•´æ–¹æ¡ˆ** (lightroom)
   
   a) åŸºæœ¬è°ƒæ•´ (basic)
      - treatment: Color/Black & White
      - temperature: -100 to 100
      - tint: -100 to 100
      - exposure: -5 to +5
      - contrast: -100 to 100
      - highlights: -100 to 100
      - shadows: -100 to 100
      - whites: -100 to 100
      - blacks: -100 to 100
      - texture: -100 to 100
      - clarity: -100 to 100
      - dehaze: -100 to 100
      - vibrance: -100 to 100
      - saturation: -100 to 100
   
   b) è‰²è°ƒæ›²çº¿ (toneCurve)
      - parametric: highlights, lights, darks, shadows
      - pointCurveï¼ˆå¯é€‰ï¼‰: RGBå„é€šé“çš„å…³é”®ç‚¹
   
   c) HSL/é¢œè‰² (hsl)
      - hue: 8ä¸ªè‰²ç›¸çš„è°ƒæ•´ï¼ˆ-100 to 100ï¼‰
      - saturation: 8ä¸ªè‰²ç›¸çš„é¥±å’Œåº¦
      - luminance: 8ä¸ªè‰²ç›¸çš„æ˜åº¦
   
   d) åˆ†ç¦»è‰²è°ƒ (splitToning)
      - highlights: hue(0-360), saturation(0-100)
      - shadows: hue(0-360), saturation(0-100)
      - balance: -100 to 100
   
   e) ç»†èŠ‚ (detail)
      - sharpening: amount, radius, detail, masking
      - noiseReduction: å„é¡¹å‚æ•°
   
   f) é•œå¤´æ ¡æ­£ (lensCorrections)
   
   g) æ•ˆæœ (effects)
      - vignette: amount, midpoint, roundness, feather
      - grain: amount, size, roughness
   
   h) æ ¡å‡† (calibration)
   
   i) è°ƒæ•´æ­¥éª¤ (steps)
      - è¯¦ç»†çš„æ“ä½œæ­¥éª¤ï¼ŒåŒ…å«é¡ºåºã€é¢æ¿ã€å‚æ•°ã€è¯´æ˜

2. **Photoshop åæœŸæ–¹æ¡ˆ** (photoshop)
   
   a) å›¾å±‚ç»“æ„ (layers)
      - åˆ—å‡ºæ‰€æœ‰å›¾å±‚ï¼ˆåç§°ã€ç±»å‹ã€æ··åˆæ¨¡å¼ã€ä¸é€æ˜åº¦ã€é¡ºåºï¼‰
   
   b) è°ƒæ•´å›¾å±‚ (adjustmentLayers)
      - æ¯ä¸ªè°ƒæ•´å›¾å±‚çš„è¯¦ç»†å‚æ•°
   
   c) æ›²çº¿ (curves)
      - å„é€šé“çš„æ›²çº¿ç‚¹
   
   d) è‰²å½©å¹³è¡¡ (colorBalance)
      - é˜´å½±/ä¸­é—´è°ƒ/é«˜å…‰çš„RGBè°ƒæ•´
   
   e) è‰²ç›¸/é¥±å’Œåº¦ (hueSaturation)
      - å…¨å±€å’Œå„è‰²ç›¸é€šé“çš„è°ƒæ•´
   
   f) Camera Rawæ»¤é•œï¼ˆå¯é€‰ï¼‰
   
   g) å…¶ä»–æ»¤é•œ (filters)
   
   h) è’™ç‰ˆæ–¹æ¡ˆ (masks)
      - è¯¦ç»†çš„è’™ç‰ˆåˆ›å»ºå’Œåº”ç”¨è¯´æ˜
   
   i) è¯¦ç»†æ­¥éª¤ (steps)
      - å®Œæ•´çš„æ“ä½œæµç¨‹ï¼ŒåŒ…æ‹¬ï¼š
        - æ­¥éª¤é¡ºåº
        - æ­¥éª¤æ ‡é¢˜
        - è¯¦ç»†è¯´æ˜
        - ä½¿ç”¨å·¥å…·
        - å‚æ•°è®¾ç½®
        - æŠ€å·§æç¤º
   
   j) å¿«æ·é”®æç¤º (shortcuts)
   
   k) æ³¨æ„äº‹é¡¹ (notes)

**é‡è¦è¦æ±‚**ï¼š
1. æ‰€æœ‰å‚æ•°å¿…é¡»åœ¨æœ‰æ•ˆèŒƒå›´å†…
2. æ­¥éª¤å¿…é¡»è¯¦ç»†ã€å¯æ“ä½œ
3. Lightroomå’ŒPhotoshopçš„æ–¹æ¡ˆè¦ç›¸äº’å‘¼åº”
4. æä¾›å…·ä½“çš„æ•°å€¼ï¼Œä¸è¦ä½¿ç”¨"é€‚å½“"ã€"ç¨å¾®"ç­‰æ¨¡ç³Šè¯æ±‡
5. æ­¥éª¤è¦è€ƒè™‘æ“ä½œé¡ºåºçš„åˆç†æ€§
6. è¿”å›æ ‡å‡†JSONæ ¼å¼
7. æ‰€æœ‰æ–‡æœ¬ä½¿ç”¨ä¸­æ–‡

è¿”å›æ ¼å¼ç¤ºä¾‹ï¼š
{
  "lightroom": {
    "basic": { ... },
    "toneCurve": { ... },
    "hsl": { ... },
    ...
    "steps": [ ... ]
  },
  "photoshop": {
    "layers": [ ... ],
    "curves": [ ... ],
    "steps": [ ... ],
    ...
  }
}
```

### Prompt ä¼˜åŒ–å»ºè®®

1. **ä½¿ç”¨Few-Shot Learning**
   - æä¾›1-2ä¸ªå®Œæ•´çš„ç¤ºä¾‹è¾“å‡º
   - å¸®åŠ©AIç†è§£æœŸæœ›çš„æ ¼å¼å’Œç»†èŠ‚ç¨‹åº¦

2. **æ˜ç¡®æ•°å€¼èŒƒå›´**
   - åœ¨Promptä¸­æ˜ç¡®æ¯ä¸ªå‚æ•°çš„å–å€¼èŒƒå›´
   - è¦æ±‚AIä¸¥æ ¼éµå®ˆèŒƒå›´

3. **ç»“æ„åŒ–è¾“å‡º**
   - è¦æ±‚JSONæ ¼å¼
   - å®šä¹‰æ¸…æ™°çš„æ•°æ®ç»“æ„
   - ä½¿ç”¨TypeScriptæ¥å£å®šä¹‰

4. **è´¨é‡æ§åˆ¶**
   - è¦æ±‚å…·ä½“æ•°å€¼è€Œéæ¨¡ç³Šæè¿°
   - è¦æ±‚ä¸“ä¸šæœ¯è¯­
   - è¦æ±‚å¯æ“ä½œæ€§

5. **åˆ†æ®µè¯·æ±‚**
   - ç¬¬ä¸€é˜¶æ®µå’Œç¬¬äºŒé˜¶æ®µåˆ†å¼€
   - é¿å…ä¸€æ¬¡æ€§è¯·æ±‚è¿‡å¤šå†…å®¹
   - æé«˜å“åº”è´¨é‡

---

## ğŸ’¾ æ•°æ®åº“è®¾è®¡

### è¡¨ç»“æ„

#### 1. uploadsï¼ˆç…§ç‰‡ä¸Šä¼ è¡¨ï¼‰
```sql
CREATE TABLE uploads (
  id VARCHAR(36) PRIMARY KEY,           -- UUID
  user_id VARCHAR(36),                  -- ç”¨æˆ·IDï¼ˆå¯é€‰ï¼‰
  source_photo_url VARCHAR(500),        -- æºç…§ç‰‡URL
  target_photo_url VARCHAR(500),        -- ç›®æ ‡ç…§ç‰‡URL
  source_photo_key VARCHAR(200),        -- å¯¹è±¡å­˜å‚¨key
  target_photo_key VARCHAR(200),        -- å¯¹è±¡å­˜å‚¨key
  similarity FLOAT,                     -- ç›¸ä¼¼åº¦
  status VARCHAR(20),                   -- çŠ¶æ€ï¼špending/analyzing/completed/failed
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  INDEX idx_user_id (user_id),
  INDEX idx_created_at (created_at)
);
```

#### 2. analysesï¼ˆåˆ†æç»“æœè¡¨ï¼‰
```sql
CREATE TABLE analyses (
  id VARCHAR(36) PRIMARY KEY,           -- UUID
  upload_id VARCHAR(36) NOT NULL,       -- å…³è” uploads.id
  stage VARCHAR(10) NOT NULL,           -- stage1/stage2
  
  -- ç¬¬ä¸€é˜¶æ®µæ•°æ®
  review_data JSON,                     -- ç…§ç‰‡ç‚¹è¯„
  composition_data JSON,                -- æ„å›¾åˆ†æ
  lighting_data JSON,                   -- å…‰å½±å‚æ•°
  color_data JSON,                      -- è‰²å½©æ–¹æ¡ˆ
  
  -- ç¬¬äºŒé˜¶æ®µæ•°æ®
  lightroom_data JSON,                  -- Lightroomæ–¹æ¡ˆ
  photoshop_data JSON,                  -- Photoshopæ–¹æ¡ˆ
  lightroom_extra JSON,                 -- Lightroomé¢å¤–æ•°æ®
  
  status VARCHAR(20),                   -- çŠ¶æ€
  error_message TEXT,                   -- é”™è¯¯ä¿¡æ¯
  processing_time INT,                  -- å¤„ç†æ—¶é—´ï¼ˆç§’ï¼‰
  
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  FOREIGN KEY (upload_id) REFERENCES uploads(id) ON DELETE CASCADE,
  INDEX idx_upload_id (upload_id),
  INDEX idx_stage (stage),
  INDEX idx_created_at (created_at)
);
```

#### 3. usersï¼ˆç”¨æˆ·è¡¨ï¼‰
```sql
CREATE TABLE users (
  id VARCHAR(36) PRIMARY KEY,           -- UUID
  email VARCHAR(255) UNIQUE,            -- é‚®ç®±
  username VARCHAR(100),                -- ç”¨æˆ·å
  avatar_url VARCHAR(500),              -- å¤´åƒURL
  avatar_key VARCHAR(200),              -- å¯¹è±¡å­˜å‚¨key
  
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  INDEX idx_email (email)
);
```

#### 4. analysis_cacheï¼ˆåˆ†æç¼“å­˜è¡¨ï¼‰
```sql
CREATE TABLE analysis_cache (
  id VARCHAR(36) PRIMARY KEY,
  cache_key VARCHAR(255) UNIQUE,        -- ç¼“å­˜é”®ï¼ˆåŸºäºç…§ç‰‡hashï¼‰
  stage VARCHAR(10),
  result_data JSON,                     -- ç¼“å­˜çš„åˆ†æç»“æœ
  hit_count INT DEFAULT 0,              -- å‘½ä¸­æ¬¡æ•°
  
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  last_accessed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  
  INDEX idx_cache_key (cache_key),
  INDEX idx_last_accessed (last_accessed_at)
);
```

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆå»ºè®®

### åç«¯æ¡†æ¶é€‰æ‹©

#### Node.js + Express
```javascript
// ä¼˜åŠ¿
- JavaScriptå…¨æ ˆå¼€å‘
- npmç”Ÿæ€ä¸°å¯Œ
- å¼‚æ­¥å¤„ç†å‹å¥½
- é€‚åˆI/Oå¯†é›†å‹åº”ç”¨

// æ¨èçš„åº“
- express: Webæ¡†æ¶
- multer: æ–‡ä»¶ä¸Šä¼ 
- sharp: å›¾ç‰‡å¤„ç†
- axios: HTTPå®¢æˆ·ç«¯
- sequelize/prisma: ORM
- bull: ä»»åŠ¡é˜Ÿåˆ—
- redis: ç¼“å­˜
```

#### Python + FastAPI
```python
# ä¼˜åŠ¿
- AI/MLç”Ÿæ€æˆç†Ÿ
- å›¾åƒå¤„ç†åº“ä¸°å¯Œ
- ç±»å‹æç¤º
- è‡ªåŠ¨APIæ–‡æ¡£

# æ¨èçš„åº“
- fastapi: Webæ¡†æ¶
- pillow: å›¾ç‰‡å¤„ç†
- opencv-python: è®¡ç®—æœºè§†è§‰
- openai: OpenAI SDK
- sqlalchemy: ORM
- celery: ä»»åŠ¡é˜Ÿåˆ—
- redis: ç¼“å­˜
```

### å¯¹è±¡å­˜å‚¨

æ¨èä½¿ç”¨ï¼š
- **AWS S3** - å…¨çƒåŒ–éƒ¨ç½²
- **é˜¿é‡Œäº‘ OSS** - å›½å†…è®¿é—®å¿«
- **è…¾è®¯äº‘ COS** - å›½å†…å¤‡é€‰
- **MinIO** - è‡ªå»ºæ–¹æ¡ˆ

### æ•°æ®åº“

æ¨èä½¿ç”¨ï¼š
- **MySQL 8.0+** - æˆç†Ÿç¨³å®šï¼ŒJSONæ”¯æŒå¥½
- **PostgreSQL 14+** - JSONåŠŸèƒ½å¼ºå¤§
- **MongoDB** - æ–‡æ¡£å‹æ•°æ®åº“ï¼ˆå¤‡é€‰ï¼‰

### ç¼“å­˜

æ¨èä½¿ç”¨ï¼š
- **Redis** - å†…å­˜ç¼“å­˜ï¼Œæ”¯æŒå¤šç§æ•°æ®ç»“æ„
- **Memcached** - ç®€å•é”®å€¼ç¼“å­˜ï¼ˆå¤‡é€‰ï¼‰

### ä»»åŠ¡é˜Ÿåˆ—

æ¨èä½¿ç”¨ï¼š
- **Bull** (Node.js) - åŸºäºRedis
- **Celery** (Python) - åŠŸèƒ½å¼ºå¤§
- **RabbitMQ** - æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆé«˜çº§ï¼‰

### AIæœåŠ¡

æ¨èä½¿ç”¨ï¼š
- **OpenAI GPT-4 Vision** - æœ€ä½³æ•ˆæœ
- **Claude 3 Opus** - å¤‡é€‰æ–¹æ¡ˆ
- **Google Gemini Pro Vision** - å¤‡é€‰æ–¹æ¡ˆ
- **è‡ªå»ºæ¨¡å‹** - æˆæœ¬è€ƒè™‘

---

## ğŸš€ å®ç°æ­¥éª¤å»ºè®®

### Phase 1: åŸºç¡€è®¾æ–½ï¼ˆç¬¬1-2å‘¨ï¼‰

1. **æ­å»ºé¡¹ç›®æ¡†æ¶**
   - é€‰æ‹©æŠ€æœ¯æ ˆ
   - åˆå§‹åŒ–é¡¹ç›®
   - é…ç½®å¼€å‘ç¯å¢ƒ

2. **é…ç½®å¯¹è±¡å­˜å‚¨**
   - åˆ›å»ºå­˜å‚¨æ¡¶
   - é…ç½®CORS
   - ç”Ÿæˆè®¿é—®å¯†é’¥

3. **é…ç½®æ•°æ®åº“**
   - åˆ›å»ºæ•°æ®åº“
   - è®¾è®¡è¡¨ç»“æ„
   - åˆ›å»ºç´¢å¼•

4. **é…ç½®Redis**
   - å®‰è£…Redis
   - é…ç½®è¿æ¥

### Phase 2: æ ¸å¿ƒåŠŸèƒ½ï¼ˆç¬¬3-4å‘¨ï¼‰

1. **ç…§ç‰‡ä¸Šä¼ åŠŸèƒ½**
   - æ–‡ä»¶æ¥æ”¶å’ŒéªŒè¯
   - ä¸Šä¼ åˆ°å¯¹è±¡å­˜å‚¨
   - ç›¸ä¼¼åº¦è®¡ç®—
   - æ•°æ®åº“è®°å½•

2. **AIåˆ†æé›†æˆ**
   - OpenAI APIé›†æˆ
   - Promptè®¾è®¡å’Œæµ‹è¯•
   - å“åº”è§£æ
   - é”™è¯¯å¤„ç†

3. **ç¬¬ä¸€é˜¶æ®µåˆ†æ**
   - å®ç°åŸºç¡€åˆ†ææ¥å£
   - æ•°æ®éªŒè¯å’Œå­˜å‚¨
   - è¿”å›æ ¼å¼åŒ–ç»“æœ

4. **ç¬¬äºŒé˜¶æ®µåˆ†æ**
   - å®ç°æ·±åº¦åˆ†ææ¥å£
   - å¤æ‚å‚æ•°å¤„ç†
   - ç»“æœæ•´åˆ

### Phase 3: ä¼˜åŒ–å’Œæ‰©å±•ï¼ˆç¬¬5-6å‘¨ï¼‰

1. **æ€§èƒ½ä¼˜åŒ–**
   - å®ç°ç¼“å­˜æœºåˆ¶
   - æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
   - CDNé…ç½®

2. **ç”¨æˆ·ç³»ç»Ÿ**
   - ç”¨æˆ·æ³¨å†Œ/ç™»å½•
   - å¤´åƒç®¡ç†
   - å†å²è®°å½•

3. **ç›‘æ§å’Œæ—¥å¿—**
   - é”™è¯¯æ—¥å¿—
   - æ€§èƒ½ç›‘æ§
   - ä½¿ç”¨ç»Ÿè®¡

4. **æµ‹è¯•**
   - å•å…ƒæµ‹è¯•
   - é›†æˆæµ‹è¯•
   - å‹åŠ›æµ‹è¯•

### Phase 4: éƒ¨ç½²ä¸Šçº¿ï¼ˆç¬¬7-8å‘¨ï¼‰

1. **éƒ¨ç½²å‡†å¤‡**
   - ç¯å¢ƒé…ç½®
   - åŸŸåå’ŒSSL
   - å¤‡ä»½ç­–ç•¥

2. **ä¸Šçº¿éƒ¨ç½²**
   - åˆ†é˜¶æ®µä¸Šçº¿
   - ç°åº¦å‘å¸ƒ
   - ç›‘æ§è§‚å¯Ÿ

3. **æ–‡æ¡£å®Œå–„**
   - APIæ–‡æ¡£
   - è¿ç»´æ–‡æ¡£
   - æ•…éšœå¤„ç†æ‰‹å†Œ

---

## ğŸ“Š æ€§èƒ½å’Œæˆæœ¬ä¼˜åŒ–

### 1. ç¼“å­˜ç­–ç•¥

```javascript
// åˆ†æç»“æœç¼“å­˜
const cacheKey = `analysis:${sourceHash}:${targetHash}:${stage}`;

// æ£€æŸ¥ç¼“å­˜
const cached = await redis.get(cacheKey);
if (cached) {
  return JSON.parse(cached);
}

// æ‰§è¡Œåˆ†æ
const result = await performAnalysis(...);

// ç¼“å­˜ç»“æœï¼ˆ24å°æ—¶è¿‡æœŸï¼‰
await redis.setex(cacheKey, 86400, JSON.stringify(result));
```

### 2. å›¾ç‰‡ç›¸ä¼¼åº¦ä¼˜åŒ–

ä½¿ç”¨å›¾åƒå“ˆå¸Œç®—æ³•å¿«é€Ÿæ£€æµ‹ï¼š
```python
import imagehash
from PIL import Image

def calculate_similarity(image1_path, image2_path):
    hash1 = imagehash.phash(Image.open(image1_path))
    hash2 = imagehash.phash(Image.open(image2_path))
    
    # è®¡ç®—æ±‰æ˜è·ç¦»
    distance = hash1 - hash2
    
    # è½¬æ¢ä¸ºç›¸ä¼¼åº¦ç™¾åˆ†æ¯”
    similarity = (64 - distance) / 64 * 100
    
    return similarity
```

### 3. AIè°ƒç”¨ä¼˜åŒ–

```javascript
// æ‰¹é‡å¤„ç†è¯·æ±‚
async function batchAnalyze(requests) {
  const queue = new Queue('analysis');
  
  // æ·»åŠ åˆ°é˜Ÿåˆ—
  for (const req of requests) {
    await queue.add(req, {
      priority: req.priority,
      attempts: 3,
      backoff: {
        type: 'exponential',
        delay: 2000
      }
    });
  }
}

// é™æµæ§åˆ¶
const limiter = new RateLimiter({
  tokensPerInterval: 10,
  interval: 'minute'
});

await limiter.removeTokens(1);
```

### 4. æˆæœ¬ä¼°ç®—

**AIè°ƒç”¨æˆæœ¬**ï¼ˆåŸºäºOpenAI GPT-4 Visionï¼‰:
- ç¬¬ä¸€é˜¶æ®µåˆ†æï¼šçº¦$0.10 - $0.20 / æ¬¡
- ç¬¬äºŒé˜¶æ®µåˆ†æï¼šçº¦$0.20 - $0.40 / æ¬¡
- æœˆåº¦10,000æ¬¡åˆ†æï¼šçº¦$3,000 - $6,000

**å¯¹è±¡å­˜å‚¨æˆæœ¬**ï¼š
- å­˜å‚¨ï¼š$0.023 / GB / æœˆ
- æµé‡ï¼š$0.09 / GB
- è¯·æ±‚ï¼š$0.005 / 1000æ¬¡

**æœåŠ¡å™¨æˆæœ¬**ï¼š
- åº”ç”¨æœåŠ¡å™¨ï¼š$50 - $200 / æœˆ
- æ•°æ®åº“ï¼š$50 - $150 / æœˆ
- Redisï¼š$20 - $50 / æœˆ

---

## ğŸ”’ å®‰å…¨æ€§è€ƒè™‘

### 1. æ–‡ä»¶ä¸Šä¼ å®‰å…¨

```javascript
// æ–‡ä»¶ç±»å‹éªŒè¯
const allowedTypes = ['image/jpeg', 'image/png', 'image/webp'];
if (!allowedTypes.includes(file.mimetype)) {
  throw new Error('Invalid file type');
}

// æ–‡ä»¶å¤§å°é™åˆ¶
const maxSize = 10 * 1024 * 1024; // 10MB
if (file.size > maxSize) {
  throw new Error('File too large');
}

// æ–‡ä»¶å†…å®¹éªŒè¯
const fileType = await FileType.fromBuffer(file.buffer);
if (!fileType || !allowedTypes.includes(fileType.mime)) {
  throw new Error('Invalid file content');
}
```

### 2. APIå®‰å…¨

```javascript
// Rate limiting
app.use('/api/', rateLimit({
  windowMs: 15 * 60 * 1000, // 15åˆ†é’Ÿ
  max: 100 // é™åˆ¶100æ¬¡è¯·æ±‚
}));

// CORSé…ç½®
app.use(cors({
  origin: process.env.ALLOWED_ORIGINS.split(','),
  credentials: true
}));

// è¯·æ±‚éªŒè¯
app.use(helmet());
app.use(express.json({ limit: '10mb' }));
```

### 3. æ•°æ®éšç§

- å®šæœŸæ¸…ç†è¿‡æœŸçš„ç…§ç‰‡å’Œåˆ†æç»“æœ
- åŠ å¯†å­˜å‚¨æ•æ„Ÿä¿¡æ¯
- éµå®ˆGDPRç­‰éšç§æ³•è§„
- æä¾›ç”¨æˆ·æ•°æ®å¯¼å‡ºå’Œåˆ é™¤åŠŸèƒ½

---

## ğŸ“š å‚è€ƒèµ„æº

### AIæ¨¡å‹æ–‡æ¡£
- [OpenAI GPT-4 Vision](https://platform.openai.com/docs/guides/vision)
- [Anthropic Claude](https://docs.anthropic.com/claude/docs)
- [Google Gemini](https://ai.google.dev/docs)

### å›¾åƒå¤„ç†
- [Sharp.js](https://sharp.pixelplumbing.com/)
- [Pillow](https://pillow.readthedocs.io/)
- [OpenCV](https://opencv.org/)

### å¯¹è±¡å­˜å‚¨
- [AWS S3](https://aws.amazon.com/s3/)
- [é˜¿é‡Œäº‘OSS](https://help.aliyun.com/product/31815.html)

### æ•°æ®åº“
- [MySQL](https://dev.mysql.com/doc/)
- [PostgreSQL](https://www.postgresql.org/docs/)
- [Redis](https://redis.io/documentation)

---

## ğŸ¯ æ€»ç»“

### æ ¸å¿ƒè¦ç‚¹

1. **ä¸¤é˜¶æ®µåˆ†æ**æ˜¯å…³é”®ç‰¹æ€§
   - ç¬¬ä¸€é˜¶æ®µï¼šå¿«é€ŸåŸºç¡€åˆ†æ
   - ç¬¬äºŒé˜¶æ®µï¼šæ·±åº¦ä¸“ä¸šæ–¹æ¡ˆ

2. **æ„å›¾åˆ†æå¿…é¡»åŒ…å«7ä¸ªç»´åº¦**
   - è¿™æ˜¯ä¸“ä¸šæ€§çš„ä½“ç°
   - æ¯ä¸ªç»´åº¦éƒ½è¦è¯¦ç»†é‡åŒ–

3. **Lightroomå’ŒPhotoshopå‚æ•°è¦å®Œæ•´**
   - æ‰€æœ‰å‚æ•°éƒ½è¦æœ‰å…·ä½“æ•°å€¼
   - æ­¥éª¤è¦è¯¦ç»†å¯æ“ä½œ
   - é¿å…æ¨¡ç³Šæè¿°

4. **Promptè®¾è®¡è‡³å…³é‡è¦**
   - å†³å®šAIè¾“å‡ºè´¨é‡
   - éœ€è¦åå¤æµ‹è¯•ä¼˜åŒ–
   - ä½¿ç”¨Few-Shotæé«˜å‡†ç¡®æ€§

5. **æ€§èƒ½å’Œæˆæœ¬å¹³è¡¡**
   - åˆç†ä½¿ç”¨ç¼“å­˜
   - ä¼˜åŒ–AIè°ƒç”¨
   - ç›‘æ§æˆæœ¬

### å¼€å‘ä¼˜å…ˆçº§

1. â­â­â­ **å¿…é¡»å®ç°**
   - ç…§ç‰‡ä¸Šä¼ 
   - ä¸¤é˜¶æ®µAIåˆ†æ
   - 7ç»´åº¦æ„å›¾åˆ†æ
   - è¯¦ç»†çš„LR/PSæ–¹æ¡ˆ

2. â­â­ **é‡è¦åŠŸèƒ½**
   - ç”¨æˆ·ç³»ç»Ÿ
   - å¤´åƒç®¡ç†
   - å†å²è®°å½•
   - ç¼“å­˜ä¼˜åŒ–

3. â­ **å¢å¼ºåŠŸèƒ½**
   - é£æ ¼æ¨¡æ‹Ÿ
   - æ‰¹é‡å¤„ç†
   - å¯¼å‡ºPDF
   - åˆ†äº«åŠŸèƒ½

---

**ç¥å¼€å‘é¡ºåˆ©ï¼å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒæœ¬æŒ‡å—æˆ–è”ç³»å‰ç«¯å›¢é˜Ÿã€‚**
