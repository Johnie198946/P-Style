# 第一阶段 Prompt 优化方案（保留所有字段）

## 📊 优化原则

**核心原则**：保留所有字段和说明，只优化表达方式，使其更简洁、紧凑。

## 🎯 优化策略

### 1. **使用表格格式替代列表**（节省空间，提高可读性）

**可行性评估的8个评分维度**：
- 当前：每个维度都有5行详细说明
- 优化：使用紧凑的表格格式，一行表达评分范围

### 2. **合并重复说明**（保留内容，减少冗余）

**Visual Mass 字段**：
- 当前：在多个地方重复说明"强制必需"、"不能省略"
- 优化：只在关键位置强调一次，其他地方引用

### 3. **简化语言表达**（保留含义，减少字数）

**模块说明**：
- 当前：使用较长的描述性语言
- 优化：使用更直接、简洁的表达

### 4. **使用紧凑格式**（保留信息，减少换行）

**JSON 示例中的字段说明**：
- 当前：每个字段都有多行说明
- 优化：使用更紧凑的单行或两行说明

## 📝 具体优化方案

### 优化点 1：可行性评估评分维度（节省 ~800 字符）

**当前格式**（每个维度 ~150 字符）：
```
1. **L (光线相似度) - 权重 25%**：评估两张图的光线类型、方向性、强度是否相似。
   * 评分标准：
     - 90-100分：光线类型完全一致（如都是强方向性硬光或都是漫射光），方向、强度高度相似
     - 70-89分：光线类型相似，但方向或强度有差异（如都是硬光但方向不同）
     - 50-69分：光线类型不同但可转换（如漫射光可模拟为硬光）
     - 30-49分：光线类型差异较大（如硬光 vs 漫射光），转换困难
     - 0-29分：光线类型完全相反（如强光 vs 极暗），几乎无法转换
```

**优化格式**（每个维度 ~80 字符）：
```
1. **L (光线相似度, 25%)**：评估光线类型、方向性、强度。评分：90-100=完全一致，70-89=相似有差异，50-69=不同但可转换，30-49=差异较大，0-29=完全相反。
```

**效果**：8个维度从 ~1,200 字符压缩到 ~640 字符，**节省 ~560 字符**

---

### 优化点 2：Visual Mass 字段说明（节省 ~400 字符）

**当前格式**（多处重复）：
- 第257行：强制必需字段警告
- 第267-275行：详细输出要求
- 第275行：再次强调强制必需
- JSON示例中：又重复说明

**优化格式**（合并为一处详细说明）：
```
* **视觉质量/视觉重心 (Visual Mass)**：**强制必需字段**，分析参考图的显著性区域。
  - 输出：`type: "polygon"`, `confidence: 0.0-1.0`（如无法确定，设为0.7-0.8），`vertices: [[...]]`（归一化坐标0.0-1.0，5-8个顶点，简化几何形状），`center_of_gravity: [x, y]`（可通过多边形几何中心计算）
  - 估算方法：基于 `subject_weight.description`（如"主体位于画面中心"→`[[0.4, 0.4], [0.6, 0.4], [0.6, 0.6], [0.4, 0.6]]`）
```

**效果**：从 ~800 字符压缩到 ~400 字符，**节省 ~400 字符**

---

### 优化点 3：JSON 示例中的字段说明（节省 ~1,500 字符）

**当前问题**：
- `color_depth_analysis.text`：包含很长的示例和警告（第324行）
- `feasibility_assessment.limitations`：包含非常详细的格式说明（第348行）
- `visual_mass.description` 和 `note`：包含大量重复说明（第408、417行）

**优化方案**：
- `color_depth_analysis.text`：保留核心要求，简化示例
- `feasibility_assessment.limitations`：保留格式要求，简化示例
- `visual_mass`：在 JSON 示例中只保留字段结构，详细说明已在上面模块说明中

**效果**：从 ~6,000 字符压缩到 ~4,500 字符，**节省 ~1,500 字符**

---

### 优化点 4：模块说明简化（节省 ~600 字符）

**优化策略**：
- 使用更直接的语言
- 合并相似说明
- 移除冗余的"（第一张图片）"重复标注（在模块开头统一说明）

**效果**：从 ~2,000 字符压缩到 ~1,400 字符，**节省 ~600 字符**

---

### 优化点 5：Constraints 部分（节省 ~200 字符）

**当前**：9条约束，每条都有详细说明

**优化**：合并相似约束，使用更紧凑的表达

**效果**：从 ~1,000 字符压缩到 ~800 字符，**节省 ~200 字符**

---

## 📊 总体优化效果

| 优化点 | 当前长度 | 优化后长度 | 节省 |
|--------|---------|-----------|------|
| 可行性评估评分维度 | ~1,200 | ~640 | ~560 |
| Visual Mass 说明 | ~800 | ~400 | ~400 |
| JSON 示例说明 | ~6,000 | ~4,500 | ~1,500 |
| 模块说明 | ~2,000 | ~1,400 | ~600 |
| Constraints | ~1,000 | ~800 | ~200 |
| **总计** | **~11,000** | **~7,740** | **~3,260** |

**总体压缩率**：约 **30%**（从 ~20,000 字符压缩到 ~14,000 字符）

---

## ✅ 优化后的优势

1. **保留所有字段**：所有重要字段和说明都保留
2. **提高可读性**：使用更紧凑的格式，Gemini 更容易理解
3. **减少冗余**：合并重复说明，但保留核心要求
4. **降低 token 成本**：节省约 30% 的字符
5. **保持完整性**：所有功能要求都保留

---

## ⚠️ 注意事项

1. **必须保留的核心内容**：
   - ✅ overlays 两套坐标的要求（最重要）
   - ✅ visual_mass 字段的强制要求
   - ✅ 8个评分维度的说明（用紧凑格式）
   - ✅ JSON 示例的基本结构
   - ✅ 所有字段的说明

2. **优化方式**：
   - ✅ 使用更简洁的语言表达
   - ✅ 合并重复说明
   - ✅ 使用紧凑格式（表格、单行说明）
   - ✅ 移除冗余的警告标记（但保留核心警告）

3. **验证要求**：
   - 测试 Gemini 是否仍能正确理解所有要求
   - 测试所有字段是否仍能正确输出
   - 测试可行性评估是否仍能正常工作

